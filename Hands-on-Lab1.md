# 演習１ - Data Factory セルフホステッド統合ランタイムとサービスエンドポイント

## 仮想マシンのデプロイ
1. [Azure portal](https://portal.azure.com)  にサインインします。
2. Azure portal の左上メニューまたはホームページから **\[リソースの作成]** を選択します。

   <img src="/images/hands-on-lab1-ADF-001.png" title="リソースの作成">
3. 検索ボックスに「Windows Server」と入力し、表示された一覧の中から同じタイトルのリンクをクリックします。  

   <img src="/images/hands-on-lab1-VM-001.png" title="検索ボックスに「Windows Server」と入力">
4. VM を作成する Windows Server バージョンは複数から選択できます。 \[Windows Server] イメージ概要パネルで \[ソフトウェア プランの選択] ドロップダウン リストをクリックして、\[Windows Server 2019 Datacenter] を探します。  

   <img src="/images/hands-on-lab1-VM-002.png" title="Windows Server 2019 Datacenter">
5. \[作成] ボタンをクリックして、VM の構成を始めます。

### VM 設定を構成する
 
　ポータルでの VM 作成エクスペリエンスは "ウィザード" の形式で提示され、VM のすべての構成領域が順番に示されます。 [次へ] ボタンをクリックすると、次の構成可能なセクションに移動します。 上部に並んでいるタブで各セクションが示されており、自由にセクション間を移動できます。

1. リソースグループで **DataFactory-Lab01-rg** を選択します。  

   <img src="/images/hands-on-lab1-VM-003.png" title="リソースグループを作成">
2. 必須項目 **\*** の各種パラメータを以下のように設定します。VM サイズは [Data Factory 前提要件](https://docs.microsoft.com/ja-jp/azure/data-factory/create-self-hosted-integration-runtime#prerequisites)の最小構成をクリアするように **D4s v3** に変更します。  
   <img src="/images/hands-on-lab1-VM-004.png" title="各種パラメータを設定">
3. その他のパラメーターは既定値のまま **\[ 次: ディスク > ]** へ行きます。 
4. ディスク項目も既定値のまま **\[ 次: ネットワーク > ]** へ行き、仮想ネットワークの **\[ 新規作成 ]** をクリックし、以下のアドレス空間とサブネットに構成します。

   <img src="/images/hands-on-lab1-VM-005.png" title="ネットワーク設定">
   
5. **\[ 次: 管理 > ]** へ行きます。 **\[ ブート診断 ]** をオフに設定し、これ以外は既定値とします。
 
6. **\[ 確認および作成 ]** をクリックし、検証に成功したら、そのまま **\[ 作成 ]** をします。

   デプロイ作業が開始され、数分後に仮想マシンのデプロイが完了します。

## Azure Storage のデプロイ
1. Azure portal の左上メニューまたはホームページから **\[リソースの作成]** を選択します。

   <img src="/images/hands-on-lab1-ADF-001.png" title="リソースの作成">
2. **\[ストレージ]** を選択してから、 **\[ストレージアカウント]** を選択します。

   <img src="/images/hands-on-lab1-Storage-001.png" title="ストレージアカウントの作成">
3. **\[サブスクリプション]** で、該当する Azure サブスクリプションを選択します。

4. **\[リソース グループ]** で、**\[新規作成]** を選択し、リソース グループの名前に「**Storage-rg**」と入力します。

5. **\[ストレージ アカウント名]** に、 **\[一意の名前]** を入力します。

6. **\[場所]** で、データ ファクトリの場所 **(Asia Pacific) 東南アジア** を選択します。

7. **\[レプリケーション]** で、**ローカル冗長ストレージ (LRS)** を選択します。

   <img src="/images/hands-on-lab1-Storage-002.png" title="ストレージアカウント 基本設定">
   
8. その他は既定値のまま **\[ 次: ネットワーク > ]** へ行きます。

9. **\[接続方法]** で、 **\[パブリック エンドポイント（選択されたネットワーク）]** を選択します。

10. **\[仮想ネットワーク]** で、**DataFactoryVNet** を選択します。

11. **\[サブネット]** で、**ADFSubnet** を選択します。

   <img src="/images/hands-on-lab1-Storage-003.png" title="ストレージアカウント 基本設定">

　※ これによりストレージアカウントは**選択した仮想ネットワークのサブネットからのみ通信を受け入れる**ように Firewall が構成されます。
 
12. **\[ 確認および作成 ]** をクリックし、検証に成功したら、そのまま **\[ 作成 ]** をします。

## Azure SQL Database のデプロイ
1. Azure portal の左上メニューまたはホームページから **\[リソースの作成]** を選択します。

   <img src="/images/hands-on-lab1-ADF-001.png" title="リソースの作成">
2. **\[データーベース]** を選択してから、 **\[SQL Database]** を選択します。

   <img src="/images/hands-on-lab1-SQLDatabase-001.png" title="SQL Database の作成">
3. **\[サブスクリプション]** で、該当する Azure サブスクリプションを選択します。

4. **\[リソース グループ]** で、**\[新規作成]** を選択し、リソース グループの名前に「**SQLDatabase-rg**」と入力します。

5. **\[データベース名]** に、 **\[一意の名前]** を入力します。
6. **\[サーバー]** で、 **新規作成** を選択します。
6. **\[場所]** で、データ ファクトリの場所 **(Asia Pacific) 東南アジア** を選択します。

7. **\[レプリケーション]** で、**ローカル冗長ストレージ (LRS)** を選択します。

   <img src="/images/hands-on-lab1-Storage-002.png" title="ストレージアカウント 基本設定">
   
8. その他は既定値のまま **\[ 次: ネットワーク > ]** へ行きます。
